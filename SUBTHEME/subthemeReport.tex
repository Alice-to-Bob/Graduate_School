% !TeX root = ./subthemeReport.tex

\documentclass[12pt,a4paper,titlepage]{jsarticle}
\usepackage{indentfirst}
\usepackage[dvipdfmx,hiresbb]{graphicx}
\usepackage{comment}
\usepackage{here}
\usepackage{enumerate}



%\input{link.bib}
%各種パッケージ
%\usepackage{...}


\title{副テーマ研究報告書}


\date{\today}\author{\\ \\ \\1910225 嶂南　秀敏\\ \\
\\ \vspace{1mm}副テーマ指導教員　知念　賢一　特任准教授}


\begin{document}

\maketitle



\begin{abstract}
    
    \if0
    　近代の情報インフラとしてのコンピュータシステムは経済活動や社会生活にとって欠くことのできない存在として、
    水道やガス電気と同じような安定性、信頼性が求められている。
    情報の保存・伝達方法の変化により、データの流通量が爆発的に拡大し、データの量・質・種類に多様化が生じた。
    これらのデータは政治、ビジネス、科学技術、災害対策など、様々な社会活動に利用され、我々の生活に大きな影響を与える事となった。
    インターネットの普及に伴い、安全なインターネットの利用に向けた課題が取り沙汰されるようになり、
    \fi
    
    \ 現在、ユーザの遠隔サーバへの利用を容易にするアプリケーションは多く存在する。
    その一方で、サーバーへの通信接続をサーバー管理者が容易に制御管理するためのアプリケーションは少ない。
    そのような通信制御のアプリケーションなしでは、サーバー管理者はユーザーの接続ごとに手動でコマンドを実行し
    管理しなければならず、サーバーを利用するユーザーが多くなるに従いサーバー管理者への負担が多くなってしまう。
    \\
    \ そこで、本研究ではサーバーへの通信制御に有効なアプリケーションを調査することを目的とし、三台のサーバーと
    一台のL2スイッチを用いて隔離ネットワークを構成し、ゲートウェイサーバーに個人のソースコード投稿サイトに公開されている
    通信制御のアプリケーションを試用することで、通信制御の容易さ、通信の可視化度合い、セキュリティ、三点について検討を行う。
    
\end{abstract}

\tableofcontents
\clearpage
\section{はじめに}

\subsection{研究背景}
クラウドサーバーサービスの普及により、一般ユーザーが遠隔サーバーにアクセスし、その資源を利用する機会が増えてきた。
Googleのクラウドサービス(GCP)、Amazonのクラウドサービス(AWS)、Microsoftのクラウドサービス(Azure)などのように
ユーザーの目的に合わせて、遠隔サーバーの利用を容易にするアプリケーションが多く存在する。
しかし、一方でサーバーへの通信接続をサーバー管理者が容易に制御管理するためのアプリケーションは少ない。
そのような通信制御のアプリケーションなしでは、サーバー管理者はユーザーの接続ごとに手動でコマンドを実行しなければならず、サーバー
を利用するユーザーが多くなるに従いサーバー管理者への負担が多くなってしまう。\par
また、企業においては令和２年現在新型コロナウィルス感染症の世界的大流行により在宅勤務(テレワーク)が推奨され、
自宅から機密の社内サーバーへのアクセスを余儀なくされている。そして、同年7月下旬に政府が在宅勤務７割を企業に要請したことにより、今後ますます
テレワークの人口が増大していきそれに伴い、大規模なリモートアクセスでのセキュリティがより重要になり、
社内サーバーの管理者の負担がますます増加していくであろう。\par 

｛ここから、サーバー管理者を楽にするアプリケーションが必要ではないかとういうことを言う｝

そこで、本研究ではサーバーへの通信制御に有効なアプリケーションを調査することを目的とし、図\ref{network_graph}のように三台のサーバーと一台のL2スイッチを用いて
隔離ネットワークを構成し、ゲートウェイサーバーにソースコード投稿サイトに公開されている通信制御のアプリケーションを試用することで
通信制御の容易さ、システム導入の容易さ、セキュリティ等の点での評価を行う。


%社内サーバー管理者はテレワークによる社外ネットワークからの大規模アクセスのためにも、自社のネットワーク構成を
%見直す必要があるかもしれない。
%\\\\
%また、アプリケーションの適応先で小規模、大規模専用のものと分別し、その中で使われている技術についても解説を行う。
%\\\\

\subsection{研究目的}
本研究では、図１のような隔離ネットワークを構成し、そこにソースコード投稿サイトに公開されている通信制御アプリケーションを試用し、
その中で小規模と大規模アプリケーションいうように分別し検討を行う。
ここでは、小規模アプリケーションをインストール先がリモートアクセス利用者のみや隔離ネットワーク内のゲートウェイサーバーだけのも
のとし、大規模のものを隔離ネットワーク内のゲートウェイ、ホストサーバー全てにインストールと設定を行う必要があるアプリケーションと
定義している。

\begin{figure}[H]
    \centering
    \includegraphics*[width=0.8\textwidth,page=2]{graphs/network_archtecture.pdf}
    \caption{ネットワーク構成図}
    \label{network_graph}
\end{figure}

同時に、その中で使われている遠隔操作、アクセスの技術と認証技術についての解説も行う。

\ 本研究では、サーバー管理者のために

そして、今回導入の規模に合わせて、小規模と大規模に分別し表に表す。

\section{遠隔アクセス技術}
本節では遠隔サーバーにアクセスし操作するための技術、ソフトウェアの解説を行う。

\subsection{Telnet}
Telnetは、ネットワークに接続された機器を遠隔操作するために使用するアプリケーション層の技術である。
サーバ・クライアント方式で提供され、Telnetサーバが操作される側、クライアントが操作する側で動作する。
Telnetを使うことでオフィスのデスクにいながら、マシンルームにあるサーバ、ルータ等の機器をパソコン上で操作できる。
PCにはtelnetクライアント、ルータなどの機器にはtelnetサーバーのサービスが有効であることが前提である。
基本的にはポート番号23を使用する。


\subsubsection{Telnetの仕組み、使用法}
Telnetの接続までの流れは以下の図\ref{telnet_flow}のようになっている。
PCからのTelnetはコマンドプロンプトやTerminalから、「telnet 150.65.136.94」というようにtelnetコマンドと接続したいサーバのIPアドレス
を入力するか、WindowsではTera Term等でIPアドレスと入力してTelnet接続を行う。
TCPによるコネクション確立後PCのコマンドプロンプトでTelnetサーバから応答画面が表示される。
Telnetで遠隔操作を行うためには対象の機器にログインする必要があるため、最初の応答画面ではパスワード要求がされる。
\begin{figure}[H]
    \centering
    \includegraphics*[width=0.8\textwidth,page=1]{graphs/network_archtecture.pdf}
    \caption{Telnet接続フロー}
    \label{telnet_flow}
\end{figure}
問題点として、認証も含めすべての通信を暗号化せずに平文のまま送信するため、パスワードを盗むのは比較的容易である。
同様の機能を持ち、情報を暗号して送信することができるSSHが存在し、セキュリティの観点からTelnetよりもSSHが推奨されている。

\subsection{暗号化技術}
暗号化技術は、情報の保護やコンピュータセキュリティに欠かせない技術である。
通信内容の保護のために、一般的に次に示す二種類の暗号化技術を使用して、認証及び暗号化通信を行っている。
\begin{itemize}
    \item 共通鍵暗号方式
    \item 公開鍵暗号方式
\end{itemize}
それぞれの暗号方式は様々なアルゴリズムによって実現されるが、元となる「平文」データを「鍵」を使って「暗号文」に変換している。
また、「暗号文」は「鍵」を使用して、「平文」に復号できる。

\subsubsection{共通鍵暗号方式}
AとBで共通の鍵を使用して、暗号化と復号化を行う。そのため、暗号化通信をする前にこの共通鍵を事前に秘密に共有する必要がある。

共通鍵暗号方式は、後述の公開鍵暗号方式に比べて、演算の処理量が少ないとういう利点ある。そのため、SSHプロトコルでは、通信内容の
暗号化にはこの共通鍵暗号方式を採用している。
\\------------- ここで図の挿入-------------------\\
代表的な暗号化アルゴリズムに「AES」が存在する。
\subsubsection{公開鍵暗号方式}
公開鍵暗号方式は、二種類の鍵である公開鍵と秘密鍵をペアで使用する。この公開鍵と秘密鍵には次に示す性質があり、公開鍵暗号方式はこれら
の性質を利用して暗号化や署名を実現している。
\begin{itemize}
    \item 公開鍵で暗号化した平文は、秘密鍵で復号できる
    \item 公開鍵で暗号化した平文は、公開鍵では復号できない
    \item 秘密鍵で暗号化したデータは、公開鍵で復号できる
    \item 公開鍵から秘密鍵を生成できない。
\end{itemize}

-----------------ここで図の挿入ーーーーーーーーーーー

公開鍵暗号方式での暗号化について次の図に示す。この図では、鍵ペアを作成したBが、公開鍵をAに公開してる。Aは、Bの公開鍵を使用して
平文を暗号化して、Bへ送付する。送付された暗号文は、B自身の秘密鍵でのみ復号できる。


代表的な暗号化アルゴリズムに「RSA暗号」「Diffi-Hellman鍵共有」等がある。
\subsection{SSH}
上記のTelnet は、遠隔操作するサーバーの認証情報を含め、通信を暗号化せずに平文のまま通信を行う。その結果、通信内容を盗聴されると

\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth, page=3]{graphs/network_archtecture.pdf}
    \caption{telnet接続による脅威}
    \label{telnet_flow}
\end{figure}
\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth, page=4]{graphs/network_archtecture.pdf}
    \caption{SSH接続によるセキュアな運用管理}
    \label{SSH_security}
\end{figure}

認証情報や通信内容が簡単に盗まれてしまう危険性がある。
この問題を解決してくれるのが、Telnetと同様な機能を持ちかつ通信内容を暗号化してくれる「SSH」（Secure SHell)である。
SSHには「SSHv1」と「SSHv2」の二種類のバージョンが存在し、本論文では安全性の高い「SSHv2」のみの解説を行う。


%SSHは二種類のバージョンが存在し「SSH1」と、それよりセキュリティ面で向上させた「SSH2」が存在する。


SSHの技術を用いるために、「OpenSSH」というソフトウェアが一般的に使用される。
認証方式として大きく２つあり、「パスワード認証」と「公開鍵認証」が使われる。
「パスワード認証」は、ログイン時に利用するアカウント情報をそのまま異利用し、IDとパスワードが一致すれば認証を行う。
「公開鍵認証」は、クライアントが公開鍵と秘密鍵を生成し、クライアント側が持つ秘密鍵が、サーバー側が持つ公開鍵に対応するものであるか
どうかで認証する。クライアント側が持つ秘密鍵はネットワーク上に送信されることはなく、サーバ側が持つ公開鍵から秘密鍵を推測されないため、
パスワード認証よりも安全な認証を行える。
SSHの公開鍵とユーザIDが"\textasciitilde/.ssh/known\_host''ファイルに登録される。
\subsubsection{SSHの機能}



%---------------メモ----------------
\begin{enumerate}
    \item セキュアリモートログイン\mbox{}\\通常,
    Secure Shell（SSH）と呼ばれる機能のこと。セキュアリモートログインを使用すると、インターネット経由でも安全に、
    運用端末からSSHサーバーへログインできる。また、通信内容を他者に見られないため、安全な運用管理を実現できる。
    \item セキュアコピー(scp)\mbox{}\\セキュアコピーを使用すると、SSHサーバからファイル転送を受け取ることできる。
    また、通信内容を他者に見られたり、改ざんされたりすることがないため、安全な運用管理を実現できる。
    \item セキュアFTP(sftp)\mbox{}\\セキュアFTPを使用すると、SSHサーバーにファイルを転送することができる。
    セキュアコピーと同様に、通信内容の盗聴や、改ざんを防ぐことができる。
\end{enumerate}

%更にログインしなくてもサーバのコマンドを実行できるSSHサーバへログインするためのユーザの認証方法には、
%telnetで使用されていたパスワード認証の他に、より安全な公開鍵認証を使用できる。
%公開鍵認証を使用することで、パスワードが漏洩し、他者に利用されることを防ぐ。


\subsubsection{SSH接続までの流れ}

まず初めに暗号化通信路の確立までの流れを以下図\ref{SSH_flow}のように示す。
\begin{figure}[h]
    \centering
    \includegraphics[width=0.9\textwidth, page=5]{graphs/network_archtecture.pdf}
    \caption{SSH接続確立までのフロー}
    \label{SSH_flow}
\end{figure}

%ーーーーーーーーーー以下メモーーーーーーーーーーーー


\begin{enumerate}[(a)]
    \item バージョンと各種暗号方式の交換\mbox{}\\ \ 最初、サーバとクライアントの間でSSHバージョン文字列を交換し、
    SSHv1で接続するか、SSHv2で接続するかを決定する。
    サーバとクライアントの間で、使用できる鍵交換方式、希望する公開鍵暗号方式、共通鍵暗号方式、メッセージ認証コード、のアルゴリズムの
    各リストを交換する。
    \item ホスト認証と暗号化通信路の確立\mbox{}\\
    \ 各SSHサーバーは、それぞれ異なるホスト鍵ペア（ホスト公開鍵とホスト秘密鍵）を保持している。ホスト鍵ペアはインストール時に生成される。
    クライアントは、サーバの正当性を確認するために、これらの鍵を使用する。
    サーバ及びクライアントは、交換した共通鍵暗号方式やメッセージ認証コードのリストから、使用するアルゴリズムを決定する。その後、
    Diffi-Hellman鍵交換方式で、暗号化通信路に使用する共通鍵を交換する。共通鍵の交換中に、サーバのホスト公開書きをクライアントで保持している
    ホスト公開鍵のデータベースと照合して、ホスト認証も行う。
    ここで、Diffi-Hellman鍵交換方式は、交換する鍵を直接送ることなく、両者で鍵を共有できるアルゴリズムである。
    \item ユーザ認証\mbox{}\\ホスト認証後、暗号化通信路が確立されると、公開鍵暗号方式またはローカルパスワードによるユーザ認証を行う。
    \begin{enumerate}[(1)]
        \item 公開鍵暗号方式によるユーザ認証\mbox{}\\ \ \ 遠隔サーバにはあらかじめユーザの公開鍵を登録しておく。クライアントでは、
        登録されているユーザ公開鍵に対応した、ユーザが所持している秘密鍵を使用して認証する。
        SSHv2では、「電子署名」という方法を使用する。\\
        \ \ まず、クライアントでは、ユーザ名、ユーザの公開鍵、ユーザの公開鍵アルゴリズムを記述した認証要求メッセージを作成する。
        そして、作成した認証要求メッセージに対して、ユーザの秘密鍵を使用して電子署名を作成する。最後にサーバーに対して認証要求メッセージに
        最後に、サーバに対して、認証要求メッセージに電子署名をつけたものを送付する。
        
        \ \ サーバでは、送付された認証要求メッセージから、ユーザ名とユーザ公開鍵を取り出し、登録済みのユーザとユーザの公開鍵であることを確認する。
        また、登録されているユーザの公開鍵を試用して、送付された電子署名を審査し、正しいユーザの電子署名であることを確認できると、ユーザの認証成功となる。
        \item ローカルパスワードによるユーザ認証\mbox{}\\
        telnetと同様に、サーバでローカルに設定されたパスワードを使用してユーザ認証を行う。しかしパスワードは暗号化された通信路を経由するため、
        第三者には見えない
        
    \end{enumerate}
    \item ログイン後\mbox{}\\
    ユーザ認証に成功すると、セッションが確立し、ユーザはログインする。ここで通常はターミナルのセッションが開始される。
    
\end{enumerate}






\subsection{VPN}
VPN(Viretural Private Network)は、通信事業者のネットワークやインターネットなどの公衆ネットワーク上で作られる、仮想的な専用ネットワーク
の総称である。VPNと言っても、通信事業者がサービス化しているようなVPNや、インターネットなどの公衆網を用いるVPN、スマートフォンやPCから
利用するVPNのように多種多様なVPNの仕組みやサービスが存在している。
%VPNを使用する目的は大きく２つある。安く通信内容の漏洩を防ぐことと、ある程度の通信品質（QoS）を確保することである。

VPNは「インターネットVPN」と「IP-VPN」の大きく２種類のサービスに分類できる。
\subsubsection*{IP-VPN}
拠点間の接続に、プロバイダなどの通信事業者の閉域ネットワーク網を使った通信技術のことで、通信業者と契約した人のみ利用できる閉ざされた
ネットワークのことである。
IP-VPNは閉域網を利用するため、トラフィック混雑時も一定の帯域が保障さら盗聴や改ざんのリスクが低いなど、コストよりも安定性や信頼性を
重視している。

\subsubsection*{インターネットVPN}
インターネットVPNとは、インターネット回線を利用したVPNのことである。\\
インターネットVPNの中にも大きく２種類あり、「IPsec-VPN」「SSL-VPN」がある。

IPsec-VPN:
IPsecは、暗号化技術によってネットワーク層にてデータのセキュリティを保護するのに使用されるプロトコルである。



-----------------境目-----------------------
VPN(Virtual Private Network)とは、インターネットなどに接続している利用者の間に仮想的なトンネルを構築し、プライベートなネットワークを
拡張する技術である。VPNを利用すれば、物理的に離れている拠点のネットワークをあたかも自分の拠点と同一ネットワーク通うな利便性や
安全性で使用できる。


%--------------ここからーーーーーーーーーーーーーー
%VPNとは、仮想的なプライベートネットワーク接続のことである。VPNによりインターネットなどの公衆網を利用する場合でも、IPsec等の高度なセキュリティを
%実装させられるため安全に企業の拠点間通信を実現できる。
----------------------ここから---------------\\
\begin{comment}
VPN(Viretural Private Network)は、通信事業者のネットワークやインターネットなどの公衆ネットワーク上で作られる、仮想的な専用ネットワーク
の総称である。VPNと言っても、通信事業者がサービス化しているようなVPNや、インターネットなどの公衆網を用いるVPN、スマートフォンやPCから
利用するVPNのように多種多様なVPNの仕組みやサービスが存在している。
VPNを使用する目的は大きく２つある。安く通信内容の漏洩を防ぐことと、ある程度の通信品質（QoS）を確保することである。

特定の拠点同士を結ぶ技術として、専用線やインターネットを用いた通信が挙げられる。専用線では、物理的に２点間を、他のユーザーなどと
共有しない専有ネットワークとして接続する。この方法は、通信路を専有するため非常に高価なものとなり、１対１の接続となるため、複数の
拠点がある場合にはその数だけ専用線が必要になってしまう。

それに対して、インターネットを用いた通信は、通信事業者の設備を数多くのユーザーで共有しているため、非常に安価となるが、一方で、
通信の盗聴や改ざんのリスクが存在する。


----------------------\\
VPNは「インターネットVPN」と「IP-VPN」の大きく２種類のサービスに分類できる。「インターネットVPN」はインターネットなどの公衆網
を利用したVPNのことであり、またその中にも２種類あり、セキュリティプロトコルにIPsecを使用した「IPsec-VPN」と、セキュリティプロトコルに
SSLを使用した「SSL-VPN」がある。そして、「IP-VPN」とは、通信事業者が提供する閉じられたIPネットワークを利用したVPNのことである。



インターネットVPNは安定性や信頼性よりもコストを重視している。一般的なインターネットは不特定多数の利用者が存在するため、
トラフィックの増大による通信の遅延や、通信途中でのデータ盗聴や改ざんのリスクが高い。一方で、IP-VPNは閉域網を利用するため、
トラフィック混雑時も一定の帯域が保障され、盗聴や改ざんのリスクが低いなどの、コストよりも安定性や信頼性を重視している。

インターネットVPNの機能は大きく分けて２つある。一つは「トンネリング（Tunneling）」と呼ばれる技術である。
トンネリングでは、パケットに新しいヘッダを付け加え、カプセル化（Encapsulation）して通信を行う。ユーザーは、データを送るがわお受け取る
側も、トンネリングされていることを意識する必要はない。
もう一つは、「通信パケットを暗号化する機能」である。トンネリングだけではデータの内容は見えてしまう。トンネリングされたパケットの盗聴
や改ざんなどを防止するために、パケットを暗号化して伝送するための仕組みが必要になる。暗号化・復号化には共通鍵暗号方式と公開鍵暗号方式
を組み合わせて使っている。

ーーーーインターネットVPNのタイプーーー\\
VPN接続のタイプにはサイト間VPNとリモートアクセスVPNの大きく２つのタイプが存在する。サイト間VPNではルータでIPsecによる暗号化と
カプセル化を行うため、クライアントPCは暗号化通信を意識することなく通信する。
リモートアクセスVPNでは、PCにVPNクライアントソフトウェアをインストールして、そのPC上で暗号化とカプセル化を行い、リモート接続先の
VPNゲートウェイと通信する。
VPNにおけるトンネリングと暗号化

VPN接続はトンネリングと暗号化によって実現している。トンネリングを行えるプロトコルには、PPTP、L2F、L2TP、IPsec、GREなどがあるが、
これらのうち暗号化を行えるプロトコルはIPsecのみである。したがって、VPN接続のためにIPsecを使用すればこのプロトコルだけで暗号化と
トンネリングを行うことができる。
\end{comment}


\subsubsection{VPNの仕組み、使用法}

\section{小規模ソフトウェア}
インストール先がゲートウェイサーバーだけのものや、隔離ネットワークにアクセスするクライアントだけの
ものを小規模のアプリケーションと分別して、評価を行う。
まず最初に、評価表を表ref に示す。


\subsection{sshuttle}
\subsubsection*{概要}
``sshuttle(https://github.com/sshuttle/sshuttle)"は、簡易VPNツールである。リモートアクセスユーザのみにインストールすれば
    使用できる。本論文では、図\ref{network_graph}のClientにインストールを行なった。
\subsubsection*{インストール方法}
今回、クライアントpcにはMacBookを用いたため、homebrewを使ってインストールを行なった。
他のOSの場合のインストール方法もいくつかここに記す。
\begin{itemize}
    \item Ubuntu \mbox{}\\ \$ apt-get install sshuttle
    \item MacOS \mbox{}\\ \$ brew install sshuttle
    \item Centos \mbox{}\\  \$ git clone https://github.com/sshuttle/sshuttle.git\\\$ cd sshuttle \\ \$ sudo ./setup.py install 
\end{itemize}
Clientのみにインストールすればよいため、とても容易に使用することができる。

\subsubsection*{使用方法}
今回、図\ref{network_graph}でClientと隔離ネットワークとVPNを形成したい時を想定する。\\
"\$ sshuttle -r pc15@15.65.136.94 10.1.1.0/24"のコマンドで、図\ref{sshuttle}のようにVPNを形成できた。
実際のterminalの図はこちらになる。
一度VPNを形成すると、多段sshをする必要などなく、自由に隔離ホストにアクセスできるようになる。



\begin{figure}[h]
    \centering
    \includegraphics[width=0.8\textwidth, page=7]{graphs/network_archtecture.pdf}
    \caption{sshuttle}
    \label{sshuttle}
\end{figure}
実際のterminalの画面出力を以下図に示す。

----------------------------------実際の画面-------------------



\subsubsection*{メリット}
sshuttleを使用するメリットは、「安全性」と「簡易化」である。\par
一般的に、図\ref{network_graph}のような隔離ネットワーク内のホストにアクセスするためには、多段sshやTunnelingを行う必要がある。
多段sshというのは今回の場合、ClientがまずGateway Serverにsshを行い、その後Gateway ServerのTerminalから、隔離ホストにssh接続するというように
複数回sshを行うことである。この場合、一度sshを切ってしまうと、再び多段sshする必要である上に、各プロセスごとに多段sshをする必要がある。
しかし、sshuttleを使用することで、一度VPNを構築すると自由に隔離ホストにアクセスすることができるため、とても容易に隔離ホストに接続
できる。\par
また、安全性の面では一般的に多段sshを行う場合は、Gateway Serverを経由するため、外部ネットワークと接続されているGateway Serverに
Clientのssh keyを保存しないといけない。しかし、sshuttleでVPNを構築することでGateway Server を経由せずに隔離ホストと接続するため、
Client-隔離ホスト間で鍵共有するだけでよいため、インターネット等と接続されているGatewayに鍵を保存するより安全である。

%図のようなネットワーク構成図の場合、隔離ホストにアクセスするためには、クライアントからgateway serverにssh接続を行い、その後再び
%隔離ホストへsshを行う、「多段ssh」や、gateway serverから隔離ホストへ「tunneling」を行う必要が発生する。

\subsection{sshportal}

\subsubsection*{概要}
``sshportal(https://github.com/moul/sshportal)"とは、透過的なSSH要塞サーバーにするソフトウェアである。
Gateway Serverのみにインストールすれば使用することができる。
sshportalを使用することで、管理者はGateway Serverにアクセスし隔離ホストにログインできる、ユーザーを動的に管理することができる。
これによって複数のユーザーを複数のホストに簡単に割り当てられる様になる。
Gateway Sserver のみが両側に関する情報を知っているため、エンドユーザはホストを知る必要がなく、アクセスする必要がある
すべてのものに自動的に接続される。


\subsubsection*{インストール方法}
sshportalはDockerを用いることで容易にインストールができる。
また、今回使用したGateway ServerのOSはCentOSv8.0であるためDockerは使用できない。代わりに"Podman"が存在しているため、
そのコマンドもここに記す。Podmanの使用法はほとんどDockerと違いはない。

\begin{itemize}
    \item Docker\mbox{}\\docker pull moul/sshportal
    \item Podman\mbox{}\\podman pull moul/sshportal
\end{itemize}

\subsubsection*{使用方法}
ここでは「Docker」使用時のコマンドを示す。
\subsubsection*{管理者の場合}
\begin{itemize}

    \item バックグラウンドサーバーを開始する \mbox{}\\docker run -p 2222:2222 -d --name=sshportal -v "\$(pwd):\$(pwd)" -w "\$(pwd)" 
    moul/sshportal:v1.10.0
    \item ログを表示させる\mbox{}\\docker logs -f sshportal
    \item 管理者(admin)としてログイン\mbox{}\\ \# ssh localhost -p 2222 -l admin\\その後 config \textgreater に切り替わる。ここで動的にユーザー登録を行う。
    
\end{itemize}
もし、サーバーにアクセスしたいユーザーがいるときの使用法
\begin{itemize}
    \item 最初にadminホストを作成する\mbox{}\\ config\textgreater  host create user1@10.1.1.8
    \item サーバーに鍵を追加する\mbox{} \\ \$ ssh user1@10.1.1.8 "\$(ssh localhost -p 222 -l admin key setup default)"
    \item これによって
\end{itemize}
ユーザーを招待する。
このコマンドでは、リモートサーバーにユーザーを作成するのではなく、sshportalデータベースにアカウントを作成する。
\begin{itemize}
    \item config\textgreater user invite bob@
    \item 
\end{itemize}


\subsubsection*{ユーザーの場合}


\subsubsection*{評価}
sshportalはインストールと管理が簡単にできるように作成されており、新規ユーザーの追加を管理者が動的に行うことができる。
また、インストール先はGateway Server のみで良いため、容易に使用することができる。
\par デメリットとしては、ユーザーの管理を動的に行うため、ユーザーが大人数になるほど管理が大変になってしまう。


\subsection{sshpiper}


\section{認証技術}
大規模のアプリケーションを実現するために、使われている認証技術の解説を行う。
\subsection{LDAP}
\subsubsection*{概要}
LDAP(Lightweight Directory Access Protocol)は、Active Directoryのようなディレクトリサービスにアクセスするためのプロトコルである。
%ディレクトリサービスというユーザやコンピュータといった情報を管理するサービス
LDAP自体はプロトコルであり、サービスやシステムを指すものではない。
LDAPを実装したデータベースをLDAPサーバと呼び、代表的なものに「Open LDAP」、「Active Directory」が存在する。\par
\subsubsection*{ディレクトリサービス}
ディレクトリサービスとは、ディレクトリと呼ばれるデータベースから、ユーザ名やマシン名などのキーを元にデータを検索、参照するための
サービスである。
一般的にデータベースと呼ばれる、SQL言語等を用いて扱う「RDB (Relatinal Data Base)」では、データ間の関係性を利用して、
データの参照、挿入、更新、削除、といった操作を行うため、それらは少し異なるものである。
グローバルでサービスを提供する場合には、分散型ディレクトリサービスが用いられ、DNS(Domain Name Service)が分散型ディレクトリサービス
として有名である。

\subsubsection*{LDAP、ディレクトリサービスの特徴}
%LDAPとはデータ追加や削除よりも検索を重視したプロトコルであるため
%、顧客、商品情報管理のように頻繁に更新されるデータを扱うのは能力は高くない。

\begin{itemize}
    \item 読み取りが高速
    \item 分散型の情報格納モデル
    \item 高度な検索機能をもつ
\end{itemize}

LDAPの特性としては、「情報の参照、検索」に特化している。
このようになる理由としては、
ディレクトリサービスとして利用されるものは、一般的なデータベースのように読み取りと書き込みが同じ頻度で発生することはない。
そして、大規模システムでは、ユーザ情報の利用は参照検索が最も頻繁に起こるため、それらの操作に対する高い性能が必須であるため、
このような特性となっている。

%LDAPを利用することで様々なサービスからLDAPかで格納された情報を参照可能なため、提供するすべてのサービスで単一のユーザー情報を
%持ちにユーザー
%認証が可能になる。（SSO シングルサインオン）

\subsubsection*{LDAPできること}
\begin{enumerate}
    \item リソースの一元管理\mbox{}\\多数のクライアントがある場合、１台１台にIDパスワード情報を入れることなく、LDAPサーバー１台
だけ登録すれば、どのクライアントからも同じIDパスワードでログインできるようになり、さらに環境もログイン時に取得できるようになる。
\\---------------ここで図をパスワードをLDAPにまとめたような図を挿入
    \item リソースのアクセス制御\mbox{}\\特定のIPアドレスからであれば、読み書き可能であるが、それ以外からは読みしかできない。
    \item 各種サービスとの連携\mbox{}\\多くのアプリケーション(Open Source Software)と連携することができる。初期のユーザ情報作成
をLDAPデータベースから行い、認証をLDAPサーバに委譲することができる。これの発展形として、一つのサーバで認証すれば、他のサーバでは
認証無しでログインできる仕組みである、シングルサインオン（SSO）を実現できる。
\end{enumerate}

\subsubsection*{LDAPの仕組み}
-----------ここは図を使って説明できたら良い。

\subsection{Kerberos}
ネットワーク内でのシステムの安全性と利便性は共存しにくいことがある。
単純にどのサービスがネットワーク上で稼働しているか、そして、使用されているサービスの動作を管理者が追跡するだけでも膨大な時間がかかることがある。
さらに、FTPプロトコルやTelnetプロトコルのようにデータを暗号化せずにネットワーク上でパスワードを送信させるというような、プロトコル自体が安全でないとき
ネットワークサービスへのユーザ認証は危険を伴うことになる。


\subsubsection*{Kerberosとは}
ネットワーク上でユーザの認証を行う方式の一つである。クライアント/サーバ間の通信を暗号化でき、比較的セキュリティが強固な認証方式となっている。
ケルベロス認証では一度ログインすると、
「チケット」と呼ばれるものを用いて認証を行えるようになるため、
次回のログイン時にID・パスワードを改めて入力する必要がなくなり、シングルサインオン（SSO）を実現できる。\par 
利用例としては、Active Directory のユーザ認証の際に用いられている。名前はギリシャ神話の地獄の門を守る番犬ケルベロスに由来している。

\subsubsection*{Kerberosの構成要素}
Kerberosの仕組みを解説する前に、用語「KDC、AS、TGS、プリンシパル、レルム」の説明を行う。

\begin{itemize}
    \item KDC (Key Distribution Center)\mbox{}\\サーバとユーザに関する信頼関係の情報を一括管理する中央データベース。
    \item AS (Authentication Server) \mbox{}\\認証サーバで、ユーザからの認証を受け付けるサーバ。
    \item TGS (Ticket Granting Server) \mbox{}\\チケット発行サーバ。各サーバを利用するためのチケットを発行するサーバ。
    \item プリンシパル (principal) \mbox{}\\ KDC認証を行うユーザやサーバのこと。
    \item レルム (realm)\mbox{}\\同じKDCの配下にあるシステムをグループとして定義する論理ネットワーク。
\end{itemize}
これらを構成すると以下のような図になる。
\\------------ここにkerberos の構成図を載っける。---------

------------------ddddddddddddd-------------

\subsubsection*{Kerberosの認証の仕組み}
Kerberos認証では、ユーザが正しいユーザIDとパスワードをAS(Authentication Server)に送信して認証に成功するとTGS(Ticket Granting server)から
チケットと呼ばれるデータを受け取れる。Kerberos認証ではこのチケットを認証に使用する。サーバはアクセスしてくるユーザがアクセス権を持っている
かどうかをユーザIDとパスワードではなくチケット（クライアントID、タイムスタンプ、有効期限が記されている）を使用して確認する。
認証時にチケットを使用することでアカウント（ユーザID、パスワード）の漏洩を防いでいる。全体的な流れを以下図に示す。

-----------------認証の流れ図ーーーーーーーーーー\\

------------------------------------
\par Kerberos認証では、チケットの盗聴によるなりすましを防ぐために、時刻同期の仕組みが用意されている。
チケットの中にはタイムスタンプ（送信時刻）が記録されており、チケットを受信したサーバがチケットのタイムスタンプとサーバの
持つ時刻と5分以上のズレがあると認証に失敗するようにないっている。
したがって、NTP（Network Time Protocol）を使用して、チケット発行側の時刻とチケット利用側の時刻が同じにする必要がある。


%\subsection{FreeIPA}

\section{大規模}
インストール先がGateway Serverだけでなく、隔離ネットワーク内のホスト全てにRole別に設定を行う必要のあるものを
大規模アプリケーションと分別して、評価を行う。
まず最初に、評価表を下表に示す。


\subsection{teleport}
\subsubsection*{概要}






\subsection{Aker}

\section{まとめ}


\end{document}